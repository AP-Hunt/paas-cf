---
platform: linux

image: docker:///governmentpaas/bosh-cli

inputs:
  - name: paas-cf
  - name: cf-manifest
  - name: bosh-secrets
run:
  path: sh
  args:
  - -c
  - -e
  - |
    ./paas-cf/concourse/scripts/bosh_login.sh bosh-secrets/bosh-secrets.yml

    uuid=$(bosh status --uuid)
    sed -e "s/^director_uuid:.*$/director_uuid: ${uuid}/" cf-manifest/cf-manifest.yml > cf-manifest-with-uuid.yml
    bosh deployment ./cf-manifest-with-uuid.yml
