## How to generate the Logit Logstash filters

### Concatenate the files in this directory

```
filter {
  <10_base.conf>
  <20_logsearch_for_cloudfoudry.conf>
  <30_custom_filters.conf>
}
```

### 10_base.conf

This contains the base filters.

Concatenate the following files:

* [filters_pre.conf.erb](https://github.com/cloudfoundry-community/logsearch-boshrelease/blob/v205.0.1/jobs/parser/templates/config/filters_pre.conf.erb)
* [redact_passwords.conf](https://github.com/cloudfoundry-community/logsearch-boshrelease/blob/v205.0.1/src/logsearch-config/src/logstash-filters/snippets/redact_passwords.conf)
* [syslog_standard.conf](https://github.com/cloudfoundry-community/logsearch-boshrelease/blob/v205.0.1/src/logsearch-config/src/logstash-filters/snippets/syslog_standard.conf)

Apply the following changes:
 - remove the ERB template blocks
 - replace the first alter {} block with this:
   ```
   mutate {
     add_field => [ "type", "syslog" ]
   }
   ```
  - remove all ruby {} blocks

### 20_logsearch_for_cloudfoudry.conf

This contains the logstash filters from the logsearch-for-cloudfoundry project. This file can be generated by following these steps

1. Install dependencies
   ```
   cd paas-logsearch-for-cloudfoundry/src/logsearch-config
   docker run --rm -ti -v $(pwd):/mnt -w /mnt jruby:9.1-alpine bash
   bundle install
   ```

1. Generate the upstream Logstash filters
   ```
   bundle exec rake build
   cat target/logstash-filters-default.conf
   ```

Remove the following filter as we can't change the index name in Logit:

```
mutate {
  add_field => { "[@metadata][index]" => "%{@index_type}" }
}
```

### 30_custom_filters.conf

You can add custom filters in this file.
